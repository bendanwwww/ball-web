<html>

	<head>
		<meta charset="utf-8">
		<title>Hello MUI</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--标准mui.css-->
		<link rel="stylesheet" href="css/mui.min.css">
		<link rel="stylesheet" href="css/iconfont.css">
		<script src="js/jquery-1.8.2.min.js"></script>
		<script src="js/mui.min.js"></script>
		<script src="js/action/init.js"></script>
		<script src="js/action/news.js"></script>
		<!--App自定义的css-->
		<style type="text/css">
			p img {
				max-width: 100%;
				height: auto;
			}
		</style>

	</head>

	<body>
		<header style="background-color: #6da0da;" class="mui-bar mui-bar-nav">
			<a style="color:#fff" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 style="color:#eaf2fc" class="mui-title"><b>新闻</b></h1>
			<div class="mui-text-right">
	            <span id="-1" style="color:#ffffff; font-size: 28;" class="mui-icon mui-icon iconfont icon-pinglun"></span>
	            &nbsp;
	        </div>
		</header>
		<div class="mui-content">
			<div class="mui-content-padded">
				<strong style="font-size: 18px;" id="title"></strong>
				<p id="fromwhere"></p>
				<div id="img"></div>
				<p id="content">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
			</div>
			<div style="background-color: #ffffff; height: 30px; line-height:30px;">
				<div style="margin-left:12px; float:left"><h5><font size="4">评论</font></h5></div>
				<div style="padding-right:20px; float:right"></div>
			</div>
			<ul id="comment" style="background-color: #efeff4;" class="mui-table-view mui-table-view-striped mui-table-view-condensed">
			</ul>
		</div>
	</body>
	<script>
		var newsId;
		var userName;
		mui.init({
			swipeBack:true //启用右滑关闭功能
		});
		mui.plusReady(function() {
			plus.webview.currentWebview().setStyle({
				scrollIndicator: 'none'
			});
			var self = plus.webview.currentWebview();
			newsId = self.newsId;
			newContent(newsId);
			showNewComment(newsId);
			findUserName(function(tx, rs) {
				if(rs.rows.length > 0) {
					userName = rs.rows.item(0).username;
				}
			});
		});
		
		mui('.mui-text-right').on('tap', 'span', function(e) {
			var replyUser = this.id;
			var text = "输入你的评论："
			e.detail.gesture.preventDefault(); //修复iOS 8.x平台存在的bug，使用plus.nativeUI.prompt会造成输入法闪一下又没了
			var btnArray = ['取消', '确定'];
			mui.prompt(text, '请输入评论', '爱篮球', btnArray, function(e) {
				if (e.index == 1) {
					var info = e.value;
					if(info == null && info.trim() == ""){
						mui.toast("请输入您的评语");
					}else{
						if(info.length > 500){
							mui.toast("您输入的评语过长，请重新输入");
						}else{
							saveNewComment(newsId, userName, replyUser, null, info);
						}
					}
				}
			})
		});
		
		mui('#comment').on('tap', 'span', function(e) {
			var replyUser = this.id.split(",");
			var text = "回复" + replyUser[1] + "的评论："
			e.detail.gesture.preventDefault(); //修复iOS 8.x平台存在的bug，使用plus.nativeUI.prompt会造成输入法闪一下又没了
			var btnArray = ['取消', '确定'];
			mui.prompt(text, '请输入评论', '爱篮球', btnArray, function(e) {
				if (e.index == 1) {
					var info = e.value;
					if(info == null && info.trim() == ""){
						mui.toast("请输入您的评语");
					}else{
						if(info.length > 500){
							mui.toast("您输入的评语过长，请重新输入");
						}else{
							saveNewComment(newsId, userName, replyUser[0], replyUser[2], info);
						}
					}
				}
			})
		});
	</script>

</html>